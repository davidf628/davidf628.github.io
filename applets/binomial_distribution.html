<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">  

<link rel='stylesheet' type='text/css' href='https://jsxgraph.uni-bayreuth.de/distrib/jsxgraph.css' />
<script src='https://jsxgraph.uni-bayreuth.de/distrib/jsxgraphcore.js' type='text/javascript'></script>
<script src='https://jsxgraph.uni-bayreuth.de/distrib/GeonextReader.js' type='text/javascript'></script>

<style>
#table-wrapper {
  
}
#table-scroll {
  height:500px;
  overflow:auto; 
  width:220px;
}
#table-wrapper table {
  width:200px;
  background:white;
  color:black;
  border: 2px solid black;  
}
#table-wrapper tr {
  text-align: center;
  nth-child(even){background-color: #f2f2f2}
}


</style>
<script>
function factorial(n) {
	var r = 1;
	var i;
	for(i = n; i > 0; i--) {
		r = r * i;
	}
	return r;
}
function combination(n, r) {
	return factorial(n) / (factorial(r) * factorial(n - r));
}
function binompdf(n, p, x) {
	return combination(n, x) * Math.pow(p, x) * Math.pow(1 - p, n - x);
}
function binomcdf(n, p, x) {
	var sum = 0;
	var i;
	for(i = 0; i <= x; i++) {
		sum += binompdf(n, p, i);
	}
	return sum;
}
function normalpdf(x, mean, stdev) {
	var scale = 1 / Math.sqrt(2 * Math.PI * Math.pow(stdev, 2));
	var z = (x - mean) / stdev;
	var exponent = -0.5 * Math.pow(z, 2);
	return scale * Math.exp(exponent);
}

</script>

<script type="text/javascript" src="http://www.google.com/jsapi"></script>

<script type="text/javascript">
	
	google.load("jquery", "1.3.2");
	google.setOnLoadCallback(function() {

	var active = false;

	$("td").mousedown(function(ev) {
		active = true;
		$(".highlight").removeClass("highlight"); // clear previous selection
		ev.preventDefault(); // this prevents text selection from happening
		$(this).addClass("highlight");
	});

	$("tr").mousemove(function(ev) {
		if (active) {
			$(this).addClass("highlight");
		}
	});
	
	$(document).mouseup(function(ev) {
		active = false;
	});

});

	function populate_table(n, p) {
	
	var i;
	var text = "";
	for(i = 0; i <= n; i++) {
		text += "<tr> <td>" + i + "</td> <td>" + binompdf(n, p, i).toFixed(3) + "</td> <td>" + binomcdf(n, p, i).toFixed(3) + "</td> </tr>";
	}
	document.getElementById("dist").innerHTML = text;
	}
	
	function create_rectangle(board, midpoint, height) {
		var p1 = board.create('point', [midpoint - 0.5, 0], { visible: false });
		var p2 = board.create('point', [midpoint + 0.5, 0], { visible: false });
		var p3 = board.create('point', [midpoint - 0.5, height], { visible: false });
		var p4 = board.create('point', [midpoint + 0.5, height], { visible: false });
		var rect = board.create('polygon', [p1, p2, p4, p3], { hasInnerPoints: false, borders: { fixed: true }, fillColor: '#0000ff' });
		rect.hasPoint = function() { return false; };  
	}
	
	function create_histogram(n, p) {
		var dataArr = [];
		var max = 0;
		var i;
		for(i = 0; i <= n; i++) {
			var val = binompdf(n, p, i);
			if(max < val) {
				max = val;
			}
			dataArr.push(val);		
		}
		var board = JXG.JSXGraph.initBoard('jxgbox', { boundingbox: [-2, max + 0.1, parseInt(n) + 1, -(0.25 * max)], axis: false, showCopyright:false });

		var y_axis = board.create('axis', [[-1,0],[-1,1]]);
		var x_axis = board.create('axis', [[0, 0], [1, 0]]);
		x_axis.removeAllTicks();
		var tickDistance = 1;
		if(n > 30) {
			tickDistance = 2;
		}
		if(n > 70) {
			tickDistance = 4;
		}
		if(n > 130) {
			tickDistance = 5;
		}
		if(n > 160) {
			alert("Max value for n is 160");
		}
		board.create('ticks', [x_axis, tickDistance], { // The number here is the distance between Major ticks
			strokeColor:'#ccc',
			majorHeight:-1, // Need this because the JXG.Options one doesn't apply
			drawLabels:true, // Needed, and only works for equidistant ticks
			label: {offset: [-4, -10]},
			minorTicks:0, // The NUMBER of small ticks between each Major tick
			drawZero:true
		});
		
		board.suspendUpdate();
		var i = 0;
		for(i = 0; i < dataArr.length; i++) {
			create_rectangle(board, i, dataArr[i]);
		}
		board.unsuspendUpdate();
		// Draw normal distribution curve
		var mean = n * p;
		var stdev = Math.sqrt(n * p * (1 - p));
		
		var graph = board.create('functiongraph', [ function(x) { return normalpdf(x, mean, stdev); }, -5, 28] );
		// Add a checkbox to turn on or off the normal curve
		//board.unsuspendUpdate();
	}

	function jsx_histogram(board, x_labels, y_data) {
		var xMin = -1;
		var xMax = x_labels.length;
		var yMin = 0;
		var yMax = Math.max(y_data) + 0.1;
		
	}

	function update_page (n, p) {
		populate_table(n, p);
		create_histogram(n, p);
	}
	
</script>

<style type="text/css">

.highlight {
	background-color:#ccffcc;
}

</style>
</head>


<body>
	n = <input type="text" id="input_n" value="15">
	p = <input type="text" id="input_p" value="0.65">
	<input type="button" value="Update" onClick="update_page(document.getElementById('input_n').value, document.getElementById('input_p').value)">

	<div id="jxgbox" class="jxgbox" style="width:800px; height:500px; float:left"></div>
	
	<div id="table-wrapper" style="float:right">
		<div id="table-scroll">
			<table>
				<thead>
					<tr>
						<th><span class="text">x</span></th>
						<th><span class="text">binompdf</span></th>
						<th><span class="text">binomcdf</span></th>
					</tr>
				</thead>
				<tbody id="dist"></tbody>
			</table>
		</div>

	</div>
	<script>

		// Initialize page with default values of n and p
	
		var n = document.getElementById('input_n').value;
		var p = document.getElementById('input_p').value;
		populate_table(n, p);
		create_histogram(n, p);
	
	</script>

</body>
</html>