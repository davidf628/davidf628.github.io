<!--
	
-->

<html>
<head>
	<meta charset="utf-8">  
		<link rel='stylesheet' type='text/css' href='https://jsxgraph.uni-bayreuth.de/distrib/jsxgraph.css' />
		<script src='https://jsxgraph.uni-bayreuth.de/distrib/jsxgraphcore.js' type='text/javascript'></script>
		<script src='https://jsxgraph.uni-bayreuth.de/distrib/GeonextReader.js' type='text/javascript'></script>
	</meta>
</head>

<body>

<h1>First Derivative Graph</h1>
f(x) = <input type="text" id="input_function" value="">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<input type="button" value="Update" onClick="update()">
</br></br>

<div id="jxgbox" class="jxgbox" style="width:720px; height:720px; float:left; resize: both"></div>


<script type='text/javascript'>
		
var board = JXG.JSXGraph.initBoard('jxgbox', {
		boundingbox: [-10,10,10,-10], 
      	showCopyright: false, 
      	showNavigation: true,
		keepaspectratio: true,
		axis: true,
      	zoom: {
            factorX: 1.25,
            factorY: 1.25,
            wheel: true,
            needshift: false,
            eps: 0.1
        }		
    });
		
// Initialize variables so that we have something we can update
curve = board.create('curve', [0, 0], 0, 0, { visible: false });
derivative = board.create('curve', [0, 0], 0, 0, { visible: false });
p = board.create('point', [0, 0], { visible: false, withLabel: false });
glider = board.create('glider', [0, 0, curve], { visible: false, name: 'P' });
q = board.create('point', [0, 0], { visible: false, withLabel: false });

function evaluate(f, x) {
	
	var relation = board.jc.snippet(f, true, 'x', true);
	return relation(x);
}

function displayNumber(val) {
	var s = val.toFixed(4);
	if(s.includes('.')) {
		while(s.slice(-1) == '0') {
			s = s.substring(0, s.length - 1);
		}
		if(s.slice(-1) == '.') {
			s = s.substring(0, s.length - 1);
		}
	}
	if(s.includes('e')) {
		s = s.substring(0, 4) + s.substring(s.indexOf('e'),s.length);
	}
	return s;
}

function update() {

	var orgbounds = board.getBoundingBox();
	var width = document.getElementById('jxgbox').clientWidth;
	var height = document.getElementById('jxgbox').clientHeight;

	board.resizeContainer(width, height);
	board.setBoundingBox(orgbounds, true);

	var f = document.getElementById('input_function').value;
	board.removeObject(curve);
	board.removeObject(p);
	board.removeObject(derivative);
	board.removeObject(glider);
	board.removeObject(q);
	
	curve = plot_function(f);
	
	board.update();	
		
}

function plot_function(ogtxt) {
		
	// This is an explicit function of the form: f(x)
	if(ogtxt == '') {
		curve = board.create('curve', [0, 0], 0, 0, { visible: false });
		derivative = board.create('curve', [0, 0], 0, 0, { visible: false });
		p = board.create('point' [0, 0], 0, 0, { visible: false, withLabel: false });
		glider = board.create('glider', [0, 0, curve], { visible: false, name: 'P' });
	} else {
		relation = board.jc.snippet(ogtxt, true, 'x', true);
		curve = board.create('functiongraph', [relation], { strokeWidth: 2 });
		d = JXG.Math.Numerics.D(relation);
		glider = board.create('glider', [0, 0, curve], { visible: true, name: 'P' });
		tangent = board.create('tangent', [glider]);
		slope = board.create('slopetriangle', [tangent]);
		
		derivative = board.create('functiongraph', [d], { strokeWidth: 2, strokeColor: 'green' });
		
		p = board.create('point', [
			// x coordinate
			function() { 
				return glider.X(); 
			}, 
			// y coordinate
			function() { 
				return d(glider.X()); 
			}], 
			{ withLabel: false, visible: false });
		
		q = board.create('point', [function() { return glider.X(); }, function() { return 0; }], { color: 'black', size: 1, withLabel: false });
		
		
		l = board.create('segment', [q, p], { lastArrow: { type: 2, size: 6 } });
		text = board.create('text', [0, 0, function() { return Math.round(slope.Value() * 100) / 100; }], { anchor: l });

		l2 = board.create('segment', [
			// first point is on the original function
			glider, 
			// second point is either the x-axis or the bottom of the arrow
			function() { 
				if(slope.Value() > 0) { 
					return q;
				} else {
					return p;
				}
			}], 
			{ strokeColor: 'gray', dash: 2 });
		
	}
	
	return curve;
}

</script>
</body>
</html>